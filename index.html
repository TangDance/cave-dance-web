<!DOCTYPE html>
<html data-wf-page="61c5e06d4c32b4d376aaf502" data-wf-site="603fe89ec4bbcece7ee6a53a" lang="en">

<head>
  <meta charset="utf-8" />
  <title>Cave Dance | CAMLab </title>
  <meta content="Cave Dance | CAMLab" property="og:title" />
  <meta content="Cave Dance Project | Harvard CAMLab" property="og:description" />
  <meta property="og:type" content="website" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link href="base.css" rel="stylesheet" type="text/css" />
  <link href="mindmap.css" rel="stylesheet" type="text/css" />
  <link href="assets/img/favicon.png" rel="shortcut icon" type="image/x-icon" />
  <link href="assets/img/favicon.png" rel="apple-touch-icon" />
  <script src="//unpkg.com/3d-force-graph"></script>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=603fe89ec4bbcece7ee6a53a" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js" type="text/javascript" crossorigin="anonymous"></script>
  <script>
  document.showLandingVideo = false;

  function setCookie() {
    const show_video_cookie_expires = 'showcavedancelandingvideoexpires';
    const has_shown_video_cookie = 'hasshowncavedancelandingvideo';
    const extendDuration = 100 * 1000; // in milliseconds
    try {
      const filteredCookies = document.cookie.split(";").filter(cookie => cookie.indexOf(has_shown_video_cookie+"=")>-1);
      const filteredExpiresCookies = document.cookie.split(";").filter(cookie => cookie.indexOf(show_video_cookie_expires+"=")>-1);
      let date = new Date();
      if (filteredCookies.length > 0) {
        const has_shown_video_cookie_value = filteredCookies[0].split('=')[1];
        const show_video_cookie_expires_value = Number(filteredExpiresCookies[0].split('=')[1]);
        console.log("show_video_cookie_expires_value = ", show_video_cookie_expires_value);
        let cookieTime = new Date();
        cookieTime.setTime(show_video_cookie_expires_value);
        console.log("show_video_cookie_expires_value = ", cookieTime.toUTCString(), "now = ", date.toUTCString());
        if (has_shown_video_cookie_value === "true" && date.getTime() < show_video_cookie_expires_value) {
          document.showLandingVideo = false;
          console.log ("do nothing, cookie not expired yet" );
        } else {
          document.showLandingVideo = true;
          document.cookie = has_shown_video_cookie+"=true;";
          document.cookie = show_video_cookie_expires + "=" + (date.getTime() + extendDuration) + ";"
          console.log("write new cookie");
        }
      } else {
        document.showLandingVideo = true;
        document.cookie = has_shown_video_cookie+"=true;";
        document.cookie = show_video_cookie_expires + "=" + (date.getTime() + extendDuration) + ";"
        console.log("write new cookie");
      }
    } catch (e) {
      document.showLandingVideo = true;
      console.log("catch block - not writing cookie: ", e );
    }
    console.log("showLandingVideo= " + document.showLandingVideo);

  }
  setCookie();
</script>
</head>

<body>
  <!-- <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
  <script>
    // VConsole will be exported to `window.VConsole` by default.
    var vConsole = new window.VConsole();
    console.log(vConsole);
  </script> -->

  <div class="gradient-embed w-embed">
    <style>
      .gradient {
            -webkit-text-fill-color: transparent;
            -webkit-background-clip: text;
         }
         .blend {
           mix-blend-mode: difference;
         }
      </style>
  </div>

  <style>

  html {background-color: black}

  #landingVideo {
    position: fixed;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
  }
  #welcome {
    opacity: 0;
    position: fixed;
    top: 50%;
    left: 45%;
  }
  #welcome button {
    background: transparent;
    outline: 1px solid rgba(255, 255, 255, 0.75);
    cursor: pointer;
    color: #9a9a9a;
    border: solid 1px var(--focus-color);
    padding: 0.4rem 0.5rem 0.2rem;
    margin: 0.2vw;
    font-size: 1rem;
    line-height: 1.2;
  }

  #welcome button:hover {
    font-weight: 600;
    background-color: rgba(255, 255, 255, 0.1);
  }
  </style>

  <div class="loader" id="loader" style="">
    <video autoplay muted autoplay="autoplay" defaultmuted playsinline id="landingVideo">
      <source src="https://camlab-cave-dance.oss-cn-hongkong.aliyuncs.com/assets/video/d2_3_.mp4" type="video/mp4">
    </video>
    <div id="welcome">
      <button>ENTER</button>
    </div>
  </div>



  <div data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b994" class="navbar">
    <div class="n-block left">
      <div data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b996" class="n-wrap">
        <div data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b997" class="n-trigger menu-trigger">
          <div data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b998" class="n-line"></div>
          <div data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b999" class="n-line bottom"></div>
        </div>
      </div>

      <!-- Site Navigation Menu -->
      <div class="menu">
        <div data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99b" class="m-inner">
          <a class="title-row" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99c" href="index.html" class="m-link w-inline-block">
            <span  data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99d" >
              <img src="assets/img/nodes.png" loading="eager"/>
              <h2 class="h-h2 menu-li title linkable">Cave Dance</h2>


              <img src="assets/img/active_item.png" class="menu-li-active-img" loading="eager"/>


            </span>
          </a>

          <link rel="prefetch" href="about.html" />
          <a aria-label="About" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="about.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable thin">About</h2>
          </a>

          <a aria-label="Connect" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="https://camlab.fas.harvard.edu/" target="_blank" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable thin">Connect</h2>
          </a>

          <div class="menu-li-border"></div>

          <link rel="prefetch" href="theater.html" />
          <a aria-label="Theater" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="theater.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable bold">Theater</h2>
          </a>

          <div class="menu-li-border"></div>

          <a aria-label="Academic" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f"  class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li bold">Academic</h2>
          </a>

          <link rel="prefetch" href="cave.html" />
          <a aria-label="Cave 220" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="cave.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable thin">Cave 220</h2>
          </a>

          <link rel="prefetch" href="music.html" />
          <a aria-label="Music Studies" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="music.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable thin">Music Studies </h2>
          </a>

          <link rel="prefetch" href="tech.html" />
          <a aria-label="Technical Roadmap" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="tech.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable thin">Technical Roadmap </h2>
          </a>

          <div class="menu-li-border"></div>

          <a aria-label="Experiments" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li bold">Experiments</h2>
          </a>

          <link rel="prefetch" href="reconstruction.html" />
          <a aria-label="Reconstructing Celestial Dance" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="reconstruction.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable thin">Reconstructing Celestial Dance</h2>
          </a>

          <link rel="prefetch" href="visualization.html" />
          <a aria-label="Visualizing Celestial Body" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="visualization.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable thin">Visualizing Celestial Body</h2>
          </a>

          <div class="menu-li-border"></div>

          <link rel="prerender" href="education.html" />
          <a aria-label="Education" draggable="false" rel="noopener" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a2" href="education.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a3" class="h-h2 menu-li linkable bold">Education</h2>
          </a>

          <div class="menu-li-border"></div>

          <link rel="prefetch" href="events.html" />
          <a aria-label="Events" rel="noopener" draggable="false" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b99f" href="events.html" class="m-link w-inline-block">
            <h2 data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a0" class="h-h2 menu-li linkable bold">Events</h2>
          </a>

        </div>

        <!-- <div class="menu-content">
          <div class="menu-mask"><img src="https://chunweb.files.wordpress.com/2022/03/amo1.png" loading="eager" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a7" alt="" class="menu-img" /><img src="https://chunweb.files.wordpress.com/2022/03/amo3.png"
              loading="eager" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a8" alt="" class="menu-img" />
            <img src="https://chunweb.files.wordpress.com/2022/03/amo2.png" loading="eager" data-w-id="2264dfe2-412c-a750-b778-fffb7eb6b9a9" alt="" class="menu-img" /></div>
        </div> -->

        <div class="m-bg"></div>

        <div data-animation="cursor" rel="noopener" data-w-id="94bf8e40-acca-479f-14ca-8485acd952d1" class="cta-wrap close">
          <div class="cta-bg"></div>
          <div class="cta-img menu-close"><img src="assets/img/close.svg" loading="lazy" alt="" class="img ico" /></div>
          <div class="cta-back">
            <div class="cta-inner"></div>
          </div>
        </div>
      </div>

    </div>

    <div class="n-block center">
      <a href="https://camlab.fas.harvard.edu/" rel="noopener" aria-label="button">
        <div class="h-h4 bold nav w-inline-block">
          <img style="opacity:0.8;     width: 11rem;" src="assets/img/CAMLab.png" loading="lazy" class="n-brand">
        </div>
      </a>
    </div>

    <div class="n-block "></div>
  </div>

  <!-- <div class="rotate-wrap">
  		<div class="rotate-text">Please rotate your device<br />to ensure a better experience</div>
  	</div> -->

  <main data-template="home" class="content demo mindmap">
    <div data-w-id="53ee3c76-c537-5088-f0d4-fc00e8f8c98a" class="wait-bar">
      <div class="outer hero-t" style="line-height: 170%">
        <!-- <div class="text disclaimer load" style="font-size: 12px">
          Loading
        </div> -->
      </div>
      <div class="progress-bar">
        <div class="progress-side"></div>
        <div data-w-id="59520e50-2513-aecd-1a28-ea8f307e866f" class="progress-face"></div>
        <div class="progress-text">
          <div class="text-block-2">Loading</div>
        </div>
      </div>
    </div>


    <div id="3d-graph" style="width:100%; height:100%"></div>


    <!-- const LABELS_MAP = { // node id => display name
    	0: "Cave Dance", // root node
    	1: "Experiments",
    	2: "Academic",
    	3: "Education",
    	4: "Events",
    	5: "Theater",
    	6: "Technical Roadmap",
    	7: "Music Studies",
    	8: "Reconstructing Celestial Dance",
    	9: "Visualizing Celestial Body",
    	10: "Cave 220"
    } -->

    <div id="hidden-buttons" style="display:none">
      <a href="about.html" id="0"></a>
      <a href="education.html" id="3"></a>
      <a href="events.html" id="4"></a>
      <a href="theater.html" id="5"></a>
      <a href="tech.html" id="6"></a>
      <a href="music.html" id="7"></a>
      <a href="reconstruction.html" id="8"></a>
      <a href="visualization.html" id="9"></a>
      <a href="cave.html" id="10"></a>
    </div>

    <div id="info" style="display: none; opacity:0">
      <div class="shadow" style="letter-spacing: -.04em; font-size: 3vw">
        <div>CAMLab </div>
        <div>x</div>
        <div>Dunhuang</div>
        <div>Cave Dance</div>
      </div>
    </div>

    <div id="mindmap-helper">
      <div id="reset-graph-wrapper">
        <img id="reset-graph" src="assets/img/nodes.png" style="width: 1.5rem; margin-right: 0.5vw; opacity: 0.8;" loading="eager" />
        <p style="margin-top: 1rem;">Re-center graph</p>
      </div>
      <div style="margin-top: 1.5rem;" id="mouse-help-wrapper">
        <div>
          <span class="mouse-1O_CunO"></span>
        </div>
        <p style=" margin-top: 1vw; ">Click and drag to look around <br> Right click to pan</p>
      </div>
    </div>

    <div class="footer">
      <div class="f-row">
        <div class="f-col left">
          <div class="f-link"><a aria-label="privacy" rel="noopener" draggable="false" href="about.html" class="h-h2 disclaimer bold">About</a></div>
        </div>
        <div class="f-col center">
          <div class="h-h2 disclaimer bold"></div>
        </div>
        <div class="f-col right">
          <div class="h-h2 disclaimer bold">
            <a href="https://camlab.fas.harvard.edu/About" aria-label="Contact" rel="noopener" draggable="false">Connect</a>
          </div>
        </div>
      </div>
    </div>


    <div data-w-id="f9fa3984-c135-a210-c0e8-a4d556d96064" class="hero-row" style="display:none">
      <div class="hero-row-wrapper-rotation">
        <div data-animation="translate" data-animation-speed="-2" class="hero-row-wrapper">
          <div data-w-id="2e0b83a3-2ddc-f8d5-5e66-67b4b7f16c12" class="hero-col">
            <h1 data-w-id="b17efb30-8309-927f-1347-0fd3b6b5f13a" class="h-h1 hero-home" style="display:block"></h1>
          </div>
          <div data-w-id="2b8b4a59-2c0d-d6ad-ded6-c96568e0cdca" class="hero-col center" style="display:none"></div>
          <div data-w-id="fed3734d-7289-44d0-92b9-3110190db00e" class="hero-col right" style="display:block">

            <div class="outer h">
              <div data-w-id="5d3f0eab-9523-e0b7-dfaf-6f3ee809c23f" class="hero-text">Dunhuang</div>
            </div>
            <div class="outer h">
              <div data-w-id="46e854ab-960f-ffc2-dadd-97d129ef5708" class="hero-text">Cave Paintings </div>
            </div>
            <div class="outer h">
              <div data-w-id="2417627d-dd84-6f04-d421-596950c84d11" class="hero-text">x</div>
            </div>
            <div class="outer h">
              <div data-w-id="2417627d-dd84-6f04-d421-596950c84d11" class="hero-text">Machine Learning</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="info-img-gradient bottom hr">
      <div class="invert w-embed">
        <style>
          .info-img-gradient.bottom.hr {
                	transform: scaleY(-1);
                }
            </style>
      </div>
    </div>
  </main>

  <div class="grid-event w-embed">
    <style>
      .grid-w {
        	pointer-events: none;
        }
      </style>
  </div>
  <script src="./composition_master.js" type="text/javascript"></script>
  <!-- <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
			"imports": {
				"three": "../build/three.module.js"
			}
		}
	</script> -->
  <script type="module">
    import * as THREE from '../build/three.module.js';
    import { BVHLoader } from './jsm/loaders/BVHLoader.js';
    import { UnrealBloomPass } from 'https://cdn.skypack.dev/pin/three@v0.136.0-4Px7Kx1INqCFBN0tXUQc/mode=imports,min/unoptimized/examples/jsm/postprocessing/UnrealBloomPass.js';
    import { CSS2DRenderer, CSS2DObject} from 'https://unpkg.com/three@0.126.1/examples/jsm/renderers/CSS2DRenderer.js';

    TweenMax.to("#welcome", 5, {opacity:1});

    const Settings = function() {
    	const yellow = 'rgba(255,160,0,0.8)';
    	const white = 'rgba(255,255,255, 0.6)';
    	const white2 = 'rgba(255,255,255, 0.9)';
    	const purple = 'rgb(204, 192, 207, 0.3)';

    	this.addBloomPass = true;
    	this.addGridHelper = false;
    	this.addBottomPlane = false;
      this.useStaticImageBackground = false;
    	this.sceneBackgroundImage = 'assets/img/desktop-bg-mindmap2.jpg';
      this.useVideoBackground = false;
    	this.addBVHtoScene = true;
    	this.initialCameraPosition = {
    		x: 0,
    		y: 0,
    		z: 100
    	};
    	this.addWallsToScene = false;
      this.largeLinkDistance = 60;
    	this.normalLinkDistance = 20;
    	this.smallLinkDistance = 5;
    	this.linkVisiblity = true;
    	this.linkCurvature = 0.3;
    	this.linkRotation = 0;
    	this.nodeColor = white;
    	this.hoveredNodeColor = white2;
    	this.linkedNodeColor = this.hoveredNodeColor;
    	this.rootNodeSize = 7;
    	this.largeNodeSize = 9;
    	this.nodeSize = 2;
    	this.childLinkNodeSize = 0.1;
    	this.nodeResolution = 15; // Force Graph default is 8
    };
    const settings = new Settings();

    const nodeSize = (nodeId) => {
    	let size;
    	if (LARGE_NODE_SIZE_NODE_IDS.indexOf(nodeId) > -1) {
    		size = settings.largeNodeSize;
    	} else {
    		size = nodeId === 0 ? settings.rootNodeSize : (nodeId > N ? settings.childLinkNodeSize : settings.nodeSize);
    	}
    	return size;
    };

    //createVideoSrcDOMs();

    const black = "#000000";
    const deepblue = "#010110";
    const BACKGROUND_COLOR_FORCE_GRAPH = "black"; //deepblue;
    const LABELS_MAP = { // node id => display name
    	0: "Cave Dance", // root node
    	1: "Experiments",
    	2: "Academic",
    	3: "Education",
    	4: "Events",
    	5: "Theater",
    	6: "Technical Roadmap",
    	7: "Music Studies",
    	8: "Reconstructing Celestial Dance",
    	9: "Visualizing Celestial Body",
    	10: "Cave 220",
    }
    const LARGE_NODE_SIZE_NODE_IDS = [5];
    const N = 5; // number of the top level categories
    const LINKS_MAP = { // source node id => target node ids
    	// NOTE: this map must include all the links appeared in CHILDREN_LINKS_MAP
    	0: [1, 2, 3, 4, 5],
    	5: [1, 4],
    	1: [2, 5, 8, 9],
    	2: [5, 1, 3, 4, 6, 7, 10],
    	3: [4]
    }
    const CHILDREN_LINKS_MAP = { // source node id => target node ids
    	0: [1, 2, 3, 4, 5],
    	1: [8, 9],
    	2: [6, 7, 10],
    }

    // Needed for BVH model animation
    let mixer, skeletonHelper, controls, renderer;
    const clock = new THREE.Clock();

    // Graph data
    let Graph;
    const rootId = 0;
    const highlightNodes = new Set();
    const highlightLinks = new Set();
    let hoverNode = null;
    let gData = {
    	nodes: [],
    	links: []
    };
    let bgData = {
    	nodes: [],
    	links: []
    };

    Object.keys(LABELS_MAP).forEach(id => {
    	const i = Number(id);
    	gData.nodes.push({
    		id: i,
    		size: nodeSize(i),
    		collapsed: false, //i > 0 && CHILDREN_LINKS_MAP[i],
    		childLinks: []
    	});
    });

    Object.keys(LINKS_MAP).forEach(sourceId => {
    	const targetIds = LINKS_MAP[sourceId];
    	if (targetIds) {
    		targetIds.forEach(targetId => {
    			gData.links.push({
    				source: Number(sourceId),
    				target: targetId
    			});
    		});
    	}
    });

    Object.keys(CHILDREN_LINKS_MAP).forEach(sourceId => {
    	sourceId = Number(sourceId);
    	const targetIds = CHILDREN_LINKS_MAP[sourceId];
    	const node = gData.nodes[sourceId];
    	targetIds.forEach(targetId => {
    		node.childLinks.push({
    			source: sourceId,
    			target: targetId
    		});
    	});
    });

    gData.links.forEach(link => {
    	const a = gData.nodes[link.source];
    	const b = gData.nodes[link.target];
    	!a.neighbors && (a.neighbors = []);
    	!b.neighbors && (b.neighbors = []);
    	a.neighbors.push(b);
    	b.neighbors.push(a);

    	!a.links && (a.links = []);
    	!b.links && (b.links = []);
    	a.links.push(link);
    	b.links.push(link);
    });

    const nodesById = Object.fromEntries(gData.nodes.map(node => [node.id, node]));

    const getPrunedTree = () => { // get the graph data with visible nodes (based on collapse state)
    	const visibleNodes = [];
    	const visibleLinks = [];

    	(function traverseTree(node = nodesById[rootId]) {
    		visibleNodes.push(node);
    		if (node.collapsed) return;
    		visibleLinks.push(...node.childLinks);
    		node.childLinks
    			.map(link => ((typeof link.target) === 'object') ? link.target : nodesById[link.target]) // get child node
    			.forEach(traverseTree);
    	})(); // IIFE

    	// show all the top-level categories by default
    	gData.links.filter(link => link.source > 0 && link.target > 0 && link.source <= N && link.target <= N).forEach(link => visibleLinks.push(link));

    	const allVisibleNodes = visibleNodes;
    	const allVisibleLinks = visibleLinks;

    	return {
    		nodes: allVisibleNodes,
    		links: allVisibleLinks
    	};
    };

    const graphContainerElem = document.getElementById('3d-graph');

    initGraph();

    function initGraph() {
    			Graph = ForceGraph3D({
    					extraRenderers: [new CSS2DRenderer()]
    				})(graphContainerElem)
    				.graphData(getPrunedTree())
    				.nodeThreeObject(({
    					id
    				}) => new THREE.Mesh(
    					[
    						new THREE.SphereGeometry(Math.random() * 10),
    					][id % 1],
    					new THREE.MeshLambertMaterial({
    						color: "rgba(255,255,255,0.6)",
    						transparent: true,
    						opacity: 0.75
    					})
    				))
    				.nodeThreeObject(node => {
    					const nodeEl = document.createElement('div');
    					nodeEl.textContent = LABELS_MAP[node.id];
    					nodeEl.className = 'node-label';
    					if (node.id === rootId) {
    						nodeEl.className += ' large';
    					} else if (node.id > N) {
    						nodeEl.className += ' small';
    					}
    					return new CSS2DObject(nodeEl);
    				})
    				.nodeThreeObjectExtend(true) // needed for the CSS2DObject renderer to work
    				.backgroundColor(BACKGROUND_COLOR_FORCE_GRAPH)
    				.nodeVal(node => node.size)
    				.nodeResolution(settings.nodeResolution)
    				.nodeOpacity(0.5)
    				.nodeColor(node => highlightNodes.has(node) ? (node === hoverNode ? settings.hoveredNodeColor : settings.linkedNodeColor) : settings.nodeColor)
    				//  .nodeColor(node => highlightNodes.has(node) ? node === hoverNode ? 'rgb(173, 214, 213, 1)' : 'rgba(255,255,255, 1)' : 'rgba(255,255,255, 0.3)')
    				.linkWidth(link => highlightLinks.has(link) ? 0.5 : 0.1)
    				.linkDirectionalArrowLength(1)
    				.linkDirectionalArrowRelPos(1)
    				.linkCurvature(settings.linkCurvature)
    				.linkCurveRotation(settings.linkRotation)
    				.linkDirectionalParticles(link => highlightLinks.has(link) ? 3 : 1)
    				.linkDirectionalParticleWidth(link => highlightLinks.has(link) ? 0.7 : 0.5)
    				.linkDirectionalParticleSpeed(link => highlightLinks.has(link) ? 0.02 : 0.005)
    				.linkDirectionalParticleResolution(10)
    				.showNavInfo(false)
    				.height('100%')
    				.width('100%')
    				.onNodeClick(clickedNode => {
    					const weblink = document.getElementById(String(clickedNode.id));
    					if (weblink) {
    						weblink.click();
    						return;
    					}

    					if (clickedNode.id === 0) {
    						resetGraph();
    					}
    					else if (clickedNode.id <= N && clickedNode.childLinks.length > 0) {
    						// Graph.zoomToFit(5000, 100, node => {
    						// 	const visible = node.id > N && clickedNode.neighbors.map(neighbor => neighbor.id).indexOf(node.id) > -1;
    						// 	console.log(visible, node.id);
    						// 	return visible;
    						// });
                resetGraph();

    						Graph.d3Force('link').distance(link => {
    							if (link.source.id === 0 && link.target.id === clickedNode.id) {
    								return settings.largeLinkDistance * 4; // lengthen its link connected to the root node
    							} else if (link.source.id === clickedNode.id && link.target.id > N) {
    								return settings.smallLinkDistance * 1; // keep its link length to its children
    							} else {
                    return settings.largeLinkDistance * 2; // shortern other links
                  }
    						});
    						//Graph.numDimensions(3); // Re-heat simulation
    						focusNode(clickedNode);
    					}
    				})
    				.onNodeDragEnd(node => { // Fix the node at the dragged position
    					node.fx = node.x;
    					node.fy = node.y;
    					node.fz = node.z;
    				})
    				.onNodeHover(node => {
    					// no state change
    					if ((!node && !highlightNodes.size) || (node && hoverNode === node)) return;

    					highlightNodes.clear();
    					highlightLinks.clear();

    					if (node) {
    						highlightNodes.add(node);
    						if (node.neighbors) {
    							node.neighbors.filter(node => node.id !== rootId && node.id > N).forEach(neighbor => highlightNodes.add(neighbor));
    						}
    						if (node.childLinks) {
    							node.childLinks.forEach(link => highlightLinks.add(link));
    						}
    					}

    					hoverNode = node || null;

    					updateHighlight();
    				})
    				.onLinkHover(link => {
    					highlightNodes.clear();
    					highlightLinks.clear();

    					if (link) {
    						highlightLinks.add(link);
    						highlightNodes.add(link.source);
    						highlightNodes.add(link.target);
    					}
    					updateHighlight();
    				})
    				.cameraPosition(
    				{
    					x: settings.initialCameraPosition.x-0,
    					y: settings.initialCameraPosition.y-0,
    					z: settings.initialCameraPosition.z+0,
    				})
    				.onBackgroundClick(() => {
    					// no op
    				});

    			const scene = Graph.scene();
    			resetLinkForceDistance();

    			TweenMax.to("#mindmap-helper", 5, {opacity:0.8});
    			TweenMax.to("#info", 5, {opacity:1});

    			controls = Graph.controls();
    			controls.minDistance = 0;
    			controls.maxDistance = 1000;

          renderer = Graph.renderer();

    			const mainLight = new THREE.PointLight(0xcccccc, 1.8, 100);
    			mainLight.position.y = 60;
    			scene.add(mainLight);

    			const purple1 = 0xe3aafd;
    			const yellow1 = 0xc0c856;
    			const green1 = 0x56c8c0;
    			const spotLight = new THREE.SpotLight( purple1, 1 );
    			spotLight.position.set( 15, -40, 35 );
    			spotLight.angle = Math.PI / 4;
    			spotLight.penumbra = 1;
    			spotLight.decay = 2;
    			spotLight.distance = 200;
    			spotLight.castShadow = true;
    			spotLight.shadow.mapSize.width = 512;
    			spotLight.shadow.mapSize.height = 512;
    			spotLight.shadow.camera.near = 10;
    			spotLight.shadow.camera.far = 200;
    			spotLight.shadow.focus = 1;
    			scene.add( spotLight );

    			const lightHelper = new THREE.SpotLightHelper( spotLight );

    			if (settings.addBloomPass) {
    				const bloomPass = new UnrealBloomPass();
    				bloomPass.strength = settings.useStaticImageBackground ? 0.4 : 0.9;
    				bloomPass.radius = 0.2;
    				bloomPass.threshold = 0.05;
    				Graph.postProcessingComposer().addPass(bloomPass);
    			}

          let backgroundTexture;
          if (settings.useStaticImageBackground) {
            backgroundTexture = new THREE.TextureLoader().load(settings.sceneBackgroundImage);
          } else if (settings.useVideoBackground) {
          //  backgroundTexture = createVideoMesh('video_bg');
          }
          if (backgroundTexture) {
            scene.background = backgroundTexture;
          }


    			if (settings.addBVHtoScene) {
    				// BVH Model
    				const loader = new BVHLoader();
    				loader.load("models/bvh/0-6000.bvh", function(result) {
    					skeletonHelper = new THREE.SkeletonHelper(result.skeleton.bones[0]);
    					skeletonHelper.skeleton = result.skeleton; // allow animation mixer to bind to THREE.SkeletonHelper directly
    					skeletonHelper.material = new THREE.MeshBasicMaterial({
    						color: "white",
    						transparent: "true",
    						opacity: "0.9",
    						wireframe: "true",
    						wireframeLinewidth: "10.0"
    					});
    					const boneContainer = new THREE.Group();
    					boneContainer.add(result.skeleton.bones[0]);

    					let x = -20;
    					let y = -20;
    					let z = 0;
    					boneContainer.translateX(x);
    					boneContainer.translateY(y);
    					boneContainer.translateZ(z);
    					skeletonHelper.translateX(x);
    					skeletonHelper.translateY(y);
    					skeletonHelper.translateZ(z);

    					const scale = 0.2;
    					boneContainer.scale.set(scale, scale, scale);
    					skeletonHelper.scale.set(scale, scale, scale);

    					scene.add(skeletonHelper);
    					scene.add(boneContainer);

    					// play animation
    					mixer = new THREE.AnimationMixer(skeletonHelper);
    					mixer.clipAction(result.clip).setEffectiveWeight(1.0).play();

    				});

    				setInterval(() => { // effectively the renderer() function
    					const delta = clock.getDelta();
    					if (mixer) mixer.update(delta);
    				}, 100);
    			}
    }


    function updateHighlight() {
    	// trigger update of highlighted objects in scene
    	Graph
    		.nodeColor(Graph.nodeColor())
    		.linkWidth(Graph.linkWidth())
    		.linkDirectionalParticles(Graph.linkDirectionalParticles());
    }

    function resetGraph() {
    	resetLinkForceDistance();
    	Graph.cameraPosition(settings.initialCameraPosition, {x:0,y:0,z:0}, 2000);
    	Graph.numDimensions(3); // re-heat simulation
    }

    function focusNode(node) {

      // Aim at node from outside it
      const distance = 50;
      const distRatio = 2 + distance/Math.hypot(node.x, node.y, node.z);
      const newPos = node.x || node.y || node.z ?
        { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio }
      : { x: -50, y: 0, z: distance - 100 }; // special case if node is in (0,0,0)

      Graph.cameraPosition(
        newPos, // new camera position
        node, // lookAt ({ x, y, z })
        5000  // ms transition duration
      );
    }

    function resetLinkForceDistance() {
    	if (Graph.d3Force('link')) {
    		Graph.d3Force('link').distance(link => {
    			if (link.source.id === 0) { // links to root
    				return settings.largeLinkDistance;
    			} else if (link.source.id <= N) { // links from 1st level parent nodes are short
    				return settings.smallLinkDistance;
    			}
    		});
    	}
    }

    window.onresize = function() {
    	location.reload();
    }

    const resetBtn = $("#reset-graph");
    if (resetBtn) {
    	resetBtn.click(() => {
    		resetGraph();
    	});
    }

    const welcome = $("#welcome");
    if (welcome) {
      welcome.click(() => {
        TweenMax.to(".loader", 2, {opacity:0, display:"none"});
      });
    }

    // function createVideoSrcDOMs() {
		// 	["assets/video/AmoSequence01.mp4"].forEach((videoSrc, i) => {
		// 		const video = document.createElement('video');
		// 		video.id = 'video_bg';
		// 		video.src = videoSrc;
		// 		video.autoplay = true;
		// 		video.muted = true;
		// 		video.loop = true;
		// 		video.playsinline = true;
		// 		video.crossOrigin = 'anonymous';
		// 		document.body.appendChild(video);
		// 	});
		// }

    function createVideoMesh(videoId) {
      const video = document.getElementById( videoId );
      video.play(); // this is the key to play video
      const texture = new THREE.VideoTexture( video );
      texture.minFilter = THREE.LinearFilter;
      texture.magFilter = THREE.LinearFilter;
      texture.repeat.set(0.5, 1); // this scales the video
      const geometry = new THREE.BoxGeometry(settings.videoWidth, settings.videoHeight, settings.videoDepth);
      const material = new THREE.MeshBasicMaterial({
        map: texture,
        side: THREE.FrontSide,
        toneMapped: false,
        transparent: true,
        opacity: 1
      });
      return new THREE.Mesh(geometry, material);
    }
  </script>

  <script>
    //100vh Fix on Mobile
    let vh = window.innerHeight * 0.01;
    let size = 0;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
    window.addEventListener('resize', () => {
      if (window.innerWidth === size) return;
      size = window.innerWidth;
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    });
  </script>

  <script>
    if (!document.showLandingVideo) {
      console.log("hide");
      $("#loader").hide();
    }
  </script>

</body>

</html>
